!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WaveformData=e()}(this,function(){"use strict";function i(t,e){this._waveformData=t,this._channelIndex=e}i.prototype.min_sample=function(t){t=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._at(t)},i.prototype.max_sample=function(t){t=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._at(t)},i.prototype.set_min_sample=function(t,e){t=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._set_at(t,e)},i.prototype.set_max_sample=function(t,e){t=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._set_at(t,e)},i.prototype.min_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex)},i.prototype.max_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex+1)};var p=127,f=-128;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=null;try{n=("undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads")).Worker}catch(i){}t="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9hdWRhY2l0eS9zb3VyY2UvYnJvd3NlL2F1ZGFjaXR5LXNyYy90cnVuay9zcmMvQmxvY2tGaWxlLmNwcAogICAqLwogIHZhciBJTlQ4X01BWCA9IDEyNzsKICB2YXIgSU5UOF9NSU4gPSAtMTI4OwoKICBmdW5jdGlvbiBjYWxjdWxhdGVXYXZlZm9ybURhdGFMZW5ndGgoYXVkaW9fc2FtcGxlX2NvdW50LCBzY2FsZSkgewogICAgdmFyIGRhdGFfbGVuZ3RoID0gTWF0aC5mbG9vcihhdWRpb19zYW1wbGVfY291bnQgLyBzY2FsZSk7CiAgICB2YXIgc2FtcGxlc19yZW1haW5pbmcgPSBhdWRpb19zYW1wbGVfY291bnQgLSBkYXRhX2xlbmd0aCAqIHNjYWxlOwoKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KCiAgICByZXR1cm4gZGF0YV9sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBnZW5lcmF0ZVdhdmVmb3JtRGF0YShvcHRpb25zKSB7CiAgICB2YXIgc2NhbGUgPSBvcHRpb25zLnNjYWxlOwogICAgdmFyIGFtcGxpdHVkZV9zY2FsZSA9IG9wdGlvbnMuYW1wbGl0dWRlX3NjYWxlOwogICAgdmFyIHNwbGl0X2NoYW5uZWxzID0gb3B0aW9ucy5zcGxpdF9jaGFubmVsczsKICAgIHZhciBsZW5ndGggPSBvcHRpb25zLmxlbmd0aDsKICAgIHZhciBzYW1wbGVfcmF0ZSA9IG9wdGlvbnMuc2FtcGxlX3JhdGU7CiAgICB2YXIgY2hhbm5lbHMgPSBvcHRpb25zLmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheShjaGFubmVsKTsKICAgIH0pOwogICAgdmFyIG91dHB1dF9jaGFubmVscyA9IHNwbGl0X2NoYW5uZWxzID8gY2hhbm5lbHMubGVuZ3RoIDogMTsKICAgIHZhciB2ZXJzaW9uID0gb3V0cHV0X2NoYW5uZWxzID09PSAxID8gMSA6IDI7CiAgICB2YXIgaGVhZGVyX3NpemUgPSB2ZXJzaW9uID09PSAxID8gMjAgOiAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciB0b3RhbF9zaXplID0gaGVhZGVyX3NpemUgKyBkYXRhX2xlbmd0aCAqIDIgKiBvdXRwdXRfY2hhbm5lbHM7CiAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRvdGFsX3NpemUpOwogICAgdmFyIGRhdGFfdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgdmFyIHNjYWxlX2NvdW50ZXIgPSAwOwogICAgdmFyIG9mZnNldCA9IGhlYWRlcl9zaXplOwogICAgdmFyIGNoYW5uZWwsIGk7CiAgICB2YXIgbWluX3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICB2YXIgbWF4X3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CgogICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CgogICAgZGF0YV92aWV3LnNldEludDMyKDAsIHZlcnNpb24sIHRydWUpOyAvLyBWZXJzaW9uCgogICAgZGF0YV92aWV3LnNldFVpbnQzMig0LCAxLCB0cnVlKTsgLy8gSXMgOCBiaXQ/CgogICAgZGF0YV92aWV3LnNldEludDMyKDgsIHNhbXBsZV9yYXRlLCB0cnVlKTsgLy8gU2FtcGxlIHJhdGUKCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTIsIHNjYWxlLCB0cnVlKTsgLy8gU2NhbGUKCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTYsIGRhdGFfbGVuZ3RoLCB0cnVlKTsgLy8gTGVuZ3RoCgogICAgaWYgKHZlcnNpb24gPT09IDIpIHsKICAgICAgZGF0YV92aWV3LnNldEludDMyKDIwLCBvdXRwdXRfY2hhbm5lbHMsIHRydWUpOwogICAgfQoKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgc2FtcGxlID0gMDsKCiAgICAgIGlmIChvdXRwdXRfY2hhbm5lbHMgPT09IDEpIHsKICAgICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgY2hhbm5lbHMubGVuZ3RoOyArK2NoYW5uZWwpIHsKICAgICAgICAgIHNhbXBsZSArPSBjaGFubmVsc1tjaGFubmVsXVtpXTsKICAgICAgICB9CgogICAgICAgIHNhbXBsZSA9IE1hdGguZmxvb3IoSU5UOF9NQVggKiBzYW1wbGUgKiBhbXBsaXR1ZGVfc2NhbGUgLyBjaGFubmVscy5sZW5ndGgpOwoKICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlWzBdKSB7CiAgICAgICAgICBtaW5fdmFsdWVbMF0gPSBzYW1wbGU7CgogICAgICAgICAgaWYgKG1pbl92YWx1ZVswXSA8IElOVDhfTUlOKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVswXSA9IElOVDhfTUlOOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVswXSkgewogICAgICAgICAgbWF4X3ZhbHVlWzBdID0gc2FtcGxlOwoKICAgICAgICAgIGlmIChtYXhfdmFsdWVbMF0gPiBJTlQ4X01BWCkgewogICAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBJTlQ4X01BWDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgKytjaGFubmVsKSB7CiAgICAgICAgICBzYW1wbGUgPSBNYXRoLmZsb29yKElOVDhfTUFYICogY2hhbm5lbHNbY2hhbm5lbF1baV0gKiBhbXBsaXR1ZGVfc2NhbGUpOwoKICAgICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbY2hhbm5lbF0pIHsKICAgICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gc2FtcGxlOwoKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtjaGFubmVsXSA8IElOVDhfTUlOKSB7CiAgICAgICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gSU5UOF9NSU47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlW2NoYW5uZWxdKSB7CiAgICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IHNhbXBsZTsKCiAgICAgICAgICAgIGlmIChtYXhfdmFsdWVbY2hhbm5lbF0gPiBJTlQ4X01BWCkgewogICAgICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IElOVDhfTUFYOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoKytzY2FsZV9jb3VudGVyID09PSBzY2FsZSkgewogICAgICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7IGNoYW5uZWwrKykgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWF4X3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICAgICAgbWF4X3ZhbHVlW2NoYW5uZWxdID0gLUluZmluaXR5OwogICAgICAgIH0KCiAgICAgICAgc2NhbGVfY291bnRlciA9IDA7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoc2NhbGVfY291bnRlciA+IDApIHsKICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtjaGFubmVsXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmZmVyOwogIH0KCiAgb25tZXNzYWdlID0gZnVuY3Rpb24gb25tZXNzYWdlKGV2dCkgewogICAgdmFyIGJ1ZmZlciA9IGdlbmVyYXRlV2F2ZWZvcm1EYXRhKGV2dC5kYXRhKTsgLy8gVHJhbnNmZXIgYnVmZmVyIHRvIHRoZSBjYWxsaW5nIHRocmVhZAoKICAgIHRoaXMucG9zdE1lc3NhZ2UoYnVmZmVyLCBbYnVmZmVyXSk7CiAgICB0aGlzLmNsb3NlKCk7CiAgfTsKCn0pKCk7Cgo=";var t,r,o="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(t,e,s){e=void 0===e?null:e;s=void 0!==s&&s;var s=(t=Buffer.from(t,"base64").toString(s?"utf16":"utf8")).indexOf("\n",10)+1,i=t.substring(s)+(e?"//# sourceMappingURL="+e:"");return function(t){return new n(i,Object.assign({},t,{eval:!0}))}}(t,null,!1):function(t){return r=r||(e=void 0===(e=null)?null:e,i=(s=function(t){var e=atob(n);if(t){for(var s=new Uint8Array(e.length),i=0,a=e.length;i<a;++i)s[i]=e.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(s.buffer))}return e}(void 0!==(s=!(n="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9hdWRhY2l0eS9zb3VyY2UvYnJvd3NlL2F1ZGFjaXR5LXNyYy90cnVuay9zcmMvQmxvY2tGaWxlLmNwcAogICAqLwogIHZhciBJTlQ4X01BWCA9IDEyNzsKICB2YXIgSU5UOF9NSU4gPSAtMTI4OwoKICBmdW5jdGlvbiBjYWxjdWxhdGVXYXZlZm9ybURhdGFMZW5ndGgoYXVkaW9fc2FtcGxlX2NvdW50LCBzY2FsZSkgewogICAgdmFyIGRhdGFfbGVuZ3RoID0gTWF0aC5mbG9vcihhdWRpb19zYW1wbGVfY291bnQgLyBzY2FsZSk7CiAgICB2YXIgc2FtcGxlc19yZW1haW5pbmcgPSBhdWRpb19zYW1wbGVfY291bnQgLSBkYXRhX2xlbmd0aCAqIHNjYWxlOwoKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KCiAgICByZXR1cm4gZGF0YV9sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBnZW5lcmF0ZVdhdmVmb3JtRGF0YShvcHRpb25zKSB7CiAgICB2YXIgc2NhbGUgPSBvcHRpb25zLnNjYWxlOwogICAgdmFyIGFtcGxpdHVkZV9zY2FsZSA9IG9wdGlvbnMuYW1wbGl0dWRlX3NjYWxlOwogICAgdmFyIHNwbGl0X2NoYW5uZWxzID0gb3B0aW9ucy5zcGxpdF9jaGFubmVsczsKICAgIHZhciBsZW5ndGggPSBvcHRpb25zLmxlbmd0aDsKICAgIHZhciBzYW1wbGVfcmF0ZSA9IG9wdGlvbnMuc2FtcGxlX3JhdGU7CiAgICB2YXIgY2hhbm5lbHMgPSBvcHRpb25zLmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheShjaGFubmVsKTsKICAgIH0pOwogICAgdmFyIG91dHB1dF9jaGFubmVscyA9IHNwbGl0X2NoYW5uZWxzID8gY2hhbm5lbHMubGVuZ3RoIDogMTsKICAgIHZhciB2ZXJzaW9uID0gb3V0cHV0X2NoYW5uZWxzID09PSAxID8gMSA6IDI7CiAgICB2YXIgaGVhZGVyX3NpemUgPSB2ZXJzaW9uID09PSAxID8gMjAgOiAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciB0b3RhbF9zaXplID0gaGVhZGVyX3NpemUgKyBkYXRhX2xlbmd0aCAqIDIgKiBvdXRwdXRfY2hhbm5lbHM7CiAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRvdGFsX3NpemUpOwogICAgdmFyIGRhdGFfdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgdmFyIHNjYWxlX2NvdW50ZXIgPSAwOwogICAgdmFyIG9mZnNldCA9IGhlYWRlcl9zaXplOwogICAgdmFyIGNoYW5uZWwsIGk7CiAgICB2YXIgbWluX3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICB2YXIgbWF4X3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CgogICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CgogICAgZGF0YV92aWV3LnNldEludDMyKDAsIHZlcnNpb24sIHRydWUpOyAvLyBWZXJzaW9uCgogICAgZGF0YV92aWV3LnNldFVpbnQzMig0LCAxLCB0cnVlKTsgLy8gSXMgOCBiaXQ/CgogICAgZGF0YV92aWV3LnNldEludDMyKDgsIHNhbXBsZV9yYXRlLCB0cnVlKTsgLy8gU2FtcGxlIHJhdGUKCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTIsIHNjYWxlLCB0cnVlKTsgLy8gU2NhbGUKCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTYsIGRhdGFfbGVuZ3RoLCB0cnVlKTsgLy8gTGVuZ3RoCgogICAgaWYgKHZlcnNpb24gPT09IDIpIHsKICAgICAgZGF0YV92aWV3LnNldEludDMyKDIwLCBvdXRwdXRfY2hhbm5lbHMsIHRydWUpOwogICAgfQoKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgc2FtcGxlID0gMDsKCiAgICAgIGlmIChvdXRwdXRfY2hhbm5lbHMgPT09IDEpIHsKICAgICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgY2hhbm5lbHMubGVuZ3RoOyArK2NoYW5uZWwpIHsKICAgICAgICAgIHNhbXBsZSArPSBjaGFubmVsc1tjaGFubmVsXVtpXTsKICAgICAgICB9CgogICAgICAgIHNhbXBsZSA9IE1hdGguZmxvb3IoSU5UOF9NQVggKiBzYW1wbGUgKiBhbXBsaXR1ZGVfc2NhbGUgLyBjaGFubmVscy5sZW5ndGgpOwoKICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlWzBdKSB7CiAgICAgICAgICBtaW5fdmFsdWVbMF0gPSBzYW1wbGU7CgogICAgICAgICAgaWYgKG1pbl92YWx1ZVswXSA8IElOVDhfTUlOKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVswXSA9IElOVDhfTUlOOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVswXSkgewogICAgICAgICAgbWF4X3ZhbHVlWzBdID0gc2FtcGxlOwoKICAgICAgICAgIGlmIChtYXhfdmFsdWVbMF0gPiBJTlQ4X01BWCkgewogICAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBJTlQ4X01BWDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgKytjaGFubmVsKSB7CiAgICAgICAgICBzYW1wbGUgPSBNYXRoLmZsb29yKElOVDhfTUFYICogY2hhbm5lbHNbY2hhbm5lbF1baV0gKiBhbXBsaXR1ZGVfc2NhbGUpOwoKICAgICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbY2hhbm5lbF0pIHsKICAgICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gc2FtcGxlOwoKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtjaGFubmVsXSA8IElOVDhfTUlOKSB7CiAgICAgICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gSU5UOF9NSU47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlW2NoYW5uZWxdKSB7CiAgICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IHNhbXBsZTsKCiAgICAgICAgICAgIGlmIChtYXhfdmFsdWVbY2hhbm5lbF0gPiBJTlQ4X01BWCkgewogICAgICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IElOVDhfTUFYOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoKytzY2FsZV9jb3VudGVyID09PSBzY2FsZSkgewogICAgICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7IGNoYW5uZWwrKykgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWF4X3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICAgICAgbWF4X3ZhbHVlW2NoYW5uZWxdID0gLUluZmluaXR5OwogICAgICAgIH0KCiAgICAgICAgc2NhbGVfY291bnRlciA9IDA7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoc2NhbGVfY291bnRlciA+IDApIHsKICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtjaGFubmVsXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmZmVyOwogIH0KCiAgb25tZXNzYWdlID0gZnVuY3Rpb24gb25tZXNzYWdlKGV2dCkgewogICAgdmFyIGJ1ZmZlciA9IGdlbmVyYXRlV2F2ZWZvcm1EYXRhKGV2dC5kYXRhKTsgLy8gVHJhbnNmZXIgYnVmZmVyIHRvIHRoZSBjYWxsaW5nIHRocmVhZAoKICAgIHRoaXMucG9zdE1lc3NhZ2UoYnVmZmVyLCBbYnVmZmVyXSk7CiAgICB0aGlzLmNsb3NlKCk7CiAgfTsKCn0pKCk7Cgo="))&&s)).indexOf("\n",10)+1,s=s.substring(i)+(e?"//# sourceMappingURL="+e:""),i=new Blob([s],{type:"application/javascript"}),URL.createObjectURL(i)),new Worker(r,t);var n,e,s,i};function w(t){if(!function(t){var e=t&&"object"===a(t)&&"byteLength"in t;if(e){t=new DataView(t).getInt32(0,!0);if(1!==t&&2!==t)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}(t=(e=t)&&"object"===a(e)&&"sample_rate"in e&&"samples_per_pixel"in e&&"bits"in e&&"length"in e&&"data"in e?function(t){var e=t.data,s=t.channels||1,i=8===t.bits?1:2,a=2*t.length*s;if(e.length!==a)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var a=24+e.length*i,i=new ArrayBuffer(a),n=new DataView(i);n.setInt32(0,2,!0),n.setUint32(4,8===t.bits,!0),n.setInt32(8,t.sample_rate,!0),n.setInt32(12,t.samples_per_pixel,!0),n.setInt32(16,t.length,!0),n.setInt32(20,s,!0);var r,o=24;if(8===t.bits)for(r=0;r<e.length;r++)n.setInt8(o++,e[r],!0);else for(r=0;r<e.length;r++)n.setInt16(o,e[r],!0),o+=2;return i}(t):t))throw new TypeError("WaveformData.create(): Unknown data format");var e;this._data=new DataView(t),this._offset=2===this._version()?24:20,this._channels=[];for(var s=0;s<this.channels;s++)this._channels[s]=new i(this,s)}function g(e,t,s){var i,a=function(t){for(var e=[],s=0;s<t.numberOfChannels;++s)e.push(t.getChannelData(s).buffer);return e}(e);t.disable_worker?(i=function(t){for(var e,s,i=t.scale,a=t.amplitude_scale,n=t.split_channels,r=t.length,o=t.sample_rate,g=t.channels.map(function(t){return new Float32Array(t)}),h=n?g.length:1,n=1==(t=1===h?1:2)?20:24,l=(l=r,I=i,s=Math.floor(l/I),0<l-s*I&&s++,s),I=new ArrayBuffer(n+2*l*h),u=new DataView(I),C=0,d=n,c=new Array(h),A=new Array(h),m=0;m<h;m++)c[m]=1/0,A[m]=-1/0;for(u.setInt32(0,t,!0),u.setUint32(4,1,!0),u.setInt32(8,o,!0),u.setInt32(12,i,!0),u.setInt32(16,l,!0),2==t&&u.setInt32(20,h,!0),e=0;e<r;e++){var b=0;if(1===h){for(m=0;m<g.length;++m)b+=g[m][e];(b=Math.floor(p*b*a/g.length))<c[0]&&(c[0]=b,c[0]<f)&&(c[0]=f),b>A[0]&&(A[0]=b,A[0]>p)&&(A[0]=p)}else for(m=0;m<h;++m)(b=Math.floor(p*g[m][e]*a))<c[m]&&(c[m]=b,c[m]<f)&&(c[m]=f),b>A[m]&&(A[m]=b,A[m]>p)&&(A[m]=p);if(++C===i){for(m=0;m<h;m++)u.setInt8(d++,c[m]),u.setInt8(d++,A[m]),c[m]=1/0,A[m]=-1/0;C=0}}if(0<C)for(m=0;m<h;m++)u.setInt8(d++,c[m]),u.setInt8(d++,A[m]);return I}({scale:t.scale,amplitude_scale:t.amplitude_scale,split_channels:t.split_channels,length:e.length,sample_rate:e.sampleRate,channels:a}),s(null,new w(i),e)):((i=new o).onmessage=function(t){s(null,new w(t.data),e)},i.postMessage({scale:t.scale,amplitude_scale:t.amplitude_scale,split_channels:t.split_channels,length:e.length,sample_rate:e.sampleRate,channels:a},a))}return w.create=function(t){return new w(t)},w.createFromAudio=function(t,e){var s,i,a,n={scale:t.scale||512,amplitude_scale:t.amplitude_scale||1,split_channels:t.split_channels||!1,disable_worker:t.disable_worker||!1};if(!t.audio_context||!t.array_buffer){if(t.audio_buffer)return g(t.audio_buffer,n,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")}s=t.audio_context,t=t.array_buffer,i=n,a=e,s.decodeAudioData(t,function(t){g(t,i,a)},function(t){t=t||new DOMException("EncodingError"),a(t)})},w.prototype={resample:function(t){if(t.scale="number"==typeof t.scale?t.scale:null,t.width="number"==typeof t.width?t.width:null,null!=t.width&&t.width<=0)throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(null!=t.scale&&t.scale<=0)throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!t.scale&&!t.width)throw new Error("WaveformData.resample(): Missing scale or width option");var e=t.scale||Math.floor(this.duration*this.sample_rate/t.width),s=this.scale,i=this.length,t=i*this.scale,t=Math.ceil(t/e),a=8===this.bits?1:2,a=24+2*t*this.channels*a,a=new ArrayBuffer(a),n=new DataView(a);n.setInt32(0,2,!0),n.setUint32(4,8===this.bits,!0),n.setInt32(8,this.sample_rate,!0),n.setInt32(12,e,!0),n.setInt32(16,t,!0),n.setInt32(20,this.channels,!0);for(var r=new w(a),o=0,g=0,h=this.channels,l=new Array(h),I=new Array(h),u=0;u<h;++u)0<i?(l[u]=this.channel(u).min_sample(o),I[u]=this.channel(u).max_sample(o)):(l[u]=0,I[u]=0);var C,d,c,A,m=8===this.bits?-128:-32768,b=8===this.bits?127:32767;if(e<s)throw new Error("WaveformData.resample(): Zoom level "+e+" too low, minimum: "+s);function p(t){return Math.floor(t*e)}for(;o<i;){for(;Math.floor(p(g)/s)===o;){if(0<g)for(u=0;u<h;++u)r.channel(u).set_min_sample(g-1,l[u]),r.channel(u).set_max_sample(g-1,I[u]);if(A=o,(C=p(++g))!==p(g-1))for(u=0;u<h;++u)l[u]=b,I[u]=m}for(C=p(g),(d=Math.floor(C/s))>i&&(d=i);o<d;){for(u=0;u<h;++u)(c=this.channel(u).min_sample(o))<l[u]&&(l[u]=c),(c=this.channel(u).max_sample(o))>I[u]&&(I[u]=c);o++}}if(o!==A)for(u=0;u<h;++u)r.channel(u).set_min_sample(g-1,l[u]),r.channel(u).set_max_sample(g-1,I[u]);return r},concat:function(){var e=this,t=Array.prototype.slice.call(arguments),t=(t.forEach(function(t){if(e.channels!==t.channels||e.sample_rate!==t.sample_rate||e.bits!==t.bits||e.scale!==t.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")}),this._concatBuffers.apply(this,t));return w.create(t)},_concatBuffers:function(){for(var t=Array.prototype.slice.call(arguments),e=this._offset,s=e,i=0,a=[this].concat(t).map(function(t){return t._data.buffer}),n=0;n<a.length;n++){var r=a[n],o=new DataView(r).getInt32(16,!0);s+=r.byteLength-e,i+=o}var t=new ArrayBuffer(s),g=new DataView(a[0]),h=new DataView(t);for(n=0;n<e;n++)h.setUint8(n,g.getUint8(n));h.setInt32(16,i,!0);var l=0,I=new Uint8Array(t,e);for(n=0;n<a.length;n++)r=a[n],I.set(new Uint8Array(r,e),l),l+=r.byteLength-e;return t},_offsetValues:function(t,e,s){var i=[],a=this.channels;s+=t*a*2;for(var n=0;n<e;n++)i.push(this._at(n*a*2+s));return i},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return 2===this._version()?this._data.getInt32(20,!0):1},channel:function(t){if(0<=t&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return 8===this.bits?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+2*t,!0)},_set_at:function(t,e){return 8===this.bits?this._data.setInt8(this._offset+t,e):this._data.setInt16(this._offset+2*t,e,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},e=0;e<this.length;e++)for(var s=0;s<this.channels;s++)t.data.push(this.channel(s).min_sample(e)),t.data.push(this.channel(s).max_sample(e));return t},toArrayBuffer:function(){return this._data.buffer}},w});const ADJUST_WIDTH=10,ADJUST_HEIGHT=50,BUTTON_RADIUS=60,VIEW_BACK_COLOR="#AFAFAF",VIEW_MEASURE_LINE_COLOR="#CFCFCF",VIEW_BEAT_LINE_COLOR="#9F9F9F",VIEW_PROGRESS_COLOR="#FFFFFF",DEFAULT_BPM=120,DEFAULT_MEASURE_WIDTH=120,DEFAULT_DIVIDE_NUM=4,COLOR_DEFINE=[{wave:"#FF0000",back:"#7F0000",select:"#CF0000"},{wave:"#00FF00",back:"#007F00",select:"#00CF00"},{wave:"#0000FF",back:"#00007F",select:"#0000CF"},{wave:"#FFFF00",back:"#7F7F00",select:"#CFCF00"},{wave:"#00FFFF",back:"#007F7F",select:"#00CFCF"},{wave:"#FF00FF",back:"#7F007F",select:"#CF00CF"}];function GetRandomInt(t){return Math.floor(Math.random()*t)}function GetSecParMeasure(t){return 60/t*4}function GetSecParPixel(t,e){return GetSecParMeasure(t)/e}function GetSecFromWorldPos(t,e,s){return s*GetSecParPixel(t,e)}function GetMeasurePos(t,e){return e/t}function GetWorldPosFromMeasurePos(t,e,s){return s*e}function GetElem(t){return document.getElementById(t)}function GetParent(t){return document.getElementById(t).parentNode}function CreateSVGElem(t,e){t=document.createElementNS("http://www.w3.org/2000/svg",t);return null!=e&&(t.id=e),t}function CreateGroup(t,e,s,i,a){t=CreateSVGElem("g",t);return t.setAttribute("width",i),t.setAttribute("height",a),t.setAttribute("transform",`translate(${e}, ${s})`),t}function CreateWaveFormPath(e,t,s,i){var a=(t,e)=>{return e-(t+128)*e/256},n=e.channel(0),r=CreateSVGElem("g","wav_group"+t),o=(r.setAttribute("fill-opacity","0.5"),r.setAttribute("width",e.length),"M 0 0 ");for(let t=0;t<e.length;t++){var g=n.max_sample(t);o+=`L ${t} ${a(g,100)} `}for(let t=e.length-1;0<=t;t--){var h=n.min_sample(t);o+=`L ${t} ${a(h,100)} `}var l=CreateSVGElem("path","wav_path"+t),t=(l.setAttribute("d",o),l.setAttribute("fill",COLOR_DEFINE[i].wave),CreateRect("wav_rect"+t,0,0,e.length,100,COLOR_DEFINE[i].back,COLOR_DEFINE[i].back)),i=CreateText(null,0,12,s,"12px","#000000");return r.appendChild(t),r.appendChild(l),r.appendChild(i),r}function CreateRect(t,e,s,i,a,n,r){t=CreateSVGElem("rect",t);return t.setAttribute("x",e),t.setAttribute("y",s),t.setAttribute("width",i),t.setAttribute("height",a),null!=n&&t.setAttribute("stroke",n),null!=r&&t.setAttribute("fill",r),t}function CreateLine(t,e,s,i,a,n,r){t=CreateSVGElem("line",t);return t.setAttribute("x1",e),t.setAttribute("y1",s),t.setAttribute("x2",i),t.setAttribute("y2",a),null!=n&&t.setAttribute("stroke",n),null!=r&&t.setAttribute("stroke-width",r),t}function CreateUse(t,e,s,i){t=CreateSVGElem("use",t);return t.setAttribute("href","#"+i),t.setAttribute("x",e),t.setAttribute("y",s),t}function CreateText(t,e,s,i,a,n){t=CreateSVGElem("text",t);return t.setAttribute("x",e),t.setAttribute("y",s),t.setAttribute("font-size",a),t.setAttribute("fill",n),t.textContent=i,t}function CreateCircle(t,e,s,i,a,n){t=CreateSVGElem("circle",t);return t.setAttribute("cx",e),t.setAttribute("cy",s),t.setAttribute("r",i),null!=a&&t.setAttribute("stroke",a),null!=n&&t.setAttribute("fill",n),t}class Button{constructor(){this.svg=null,this.callback=null,this.fill="#CFCFCF",this.pushColor="#AF0000",this.isPush=!1}Init(t,e,s,i,a,n){e=CreateSVGElem("g",e),e.setAttribute("width",2*a),e.setAttribute("height",2*a),a=CreateCircle(null,a,a,a,"none",n);e.appendChild(a),e.addEventListener("click",this._onClick),e.addEventListener("mousedown",this._onDefaultEvent),e.addEventListener("mouseup",this._onDefaultEvent),e.addEventListener("mousemove",this._onDefaultEvent),e.addEventListener("mouseover",this._onDefaultEvent),e.setAttribute("transform",`translate(${s}, ${i})`),t.appendChild(e),this.svg=e,this.fill=n}SetBackColor(t){this.fill=t}SetActiveColor(t){this.pushColor=t}Move(t,e){this.svg.setAttribute("transform",`translate(${t}, ${e})`)}SetClick(t){this.callback=t}OnClickEvent(t){null!=this.callback&&this.callback(t)}_onClick=t=>(t.preventDefault(),t.stopPropagation(),this.svg.childNodes.item(0).setAttribute("fill",this.pushColor),this.OnClickEvent(t),setTimeout(()=>{this.svg.childNodes.item(0).setAttribute("fill",this.fill)},100),!1);_onDefaultEvent=t=>(t.preventDefault(),t.stopPropagation(),!1)}class ImgButton extends Button{constructor(){super()}Init(t,e,s,i,a,n,r){super.Init(t,e,s,i,a,n);t=CreateText(null,a,a,r,"32px","#000000");t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","central"),this.svg.appendChild(t)}}class SoundObject{constructor(t){this.audioBuffer=null,this.wave=null,this.svg=null,this.id=0,this.x=0,this.y=0,this.visible=!1,this.playback=!1,this.source=null,this.name=t,this.color_id=GetRandomInt(COLOR_DEFINE.length)}copyAudioBuffer(e){var s=new AudioBuffer({length:e.length,numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate});for(let t=0;t<s.numberOfChannels;t++){var i=e.getChannelData(t);s.copyToChannel(i,t)}return s}createWaveForm(e){return new Promise((s,i)=>{var t={audio_context:e.context,audio_buffer:this.copyAudioBuffer(this.audioBuffer),scale:2048};WaveformData.createFromAudio(t,(t,e)=>{t?i(t):(this.wave=e,s())})})}Load(t,e){return this.audioBuffer=e,this.createWaveForm(t)}SetIndex=t=>{this.id=t};CreateSVG(){this.svg=CreateWaveFormPath(this.wave,this.id,this.name,this.color_id)}SetSelected(t){var e=this.svg.childNodes.item(0);t?e.setAttribute("fill",COLOR_DEFINE[this.color_id].select):e.setAttribute("fill",COLOR_DEFINE[this.color_id].back)}Size(t,e){t=GetSecParPixel(t,e),e=this.audioBuffer.duration/t,this.svg.setAttribute("width",e),t=this.wave.length;this.svg.childNodes.item(1).setAttribute("style",`transform:scale(${e/t},1);`),this.svg.childNodes.item(0).setAttribute("width",e)}SetMouseDownEvent(e){this.svg.addEventListener("mousedown",t=>(t.preventDefault(),t.stopPropagation(),e(t,this),!1))}Play=(t,e,s,i,a)=>{this.source=t.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(e),this.source.onended=()=>{this.playback=!1};let n=!0,r=0,o=GetSecFromWorldPos(s,i,this.x);a<=o?(o-=a,r=0):o<a&&o+this.audioBuffer.duration>a?(r=a-o,o=0):(n=!1,this.source=null,this.playback=!1),n&&(this.source.start(t.currentTime+o,r),this.playback=!0)};Stop(){this.playback&&this.source.stop(),this.playback=!1,this.source=null}}class SoundObjectManager{constructor(){this.objectList=null,this.drag={isMouseDown:!1,targets:null},this.bpm=120,this.widthParMeasure=120}GetListSize(){return null==this.objectList?0:this.objectList.length}GetObjectList(){return this.objectList}OnMouseDown=(t,e)=>{var s;0==t.button&&(s=e.svg.getBoundingClientRect(),this.drag.isMouseDown=!0,t.ctrlKey||t.metaKey?(null==this.drag.targets&&(this.drag.targets=[]),t={target:e,offsetx:s.left,offsety:s.top},e.SetSelected(!0),this.drag.targets.push(t)):(null!=this.drag.targets&&0<this.drag.targets.length&&(this.drag.targets.map(t=>{t.target.SetSelected(!1)}),this.clearDragList()),this.drag.targets=[],t={target:e,offsetx:s.left,offsety:s.top},e.SetSelected(!0),this.drag.targets.push(t)))};clearDragList(){null!=this.drag.targets&&(this.drag.targets=null)}OnMouseUp(){this.drag.isMouseDown=!1}AddSound(a,t,n){return new Promise((s,i)=>{a.context.decodeAudioData(t,t=>{let e=new SoundObject(n);e.Load(a,t).then(()=>{null==this.objectList&&(this.objectList=[]);var t=this.objectList.length;e.SetIndex(t),e.CreateSVG(),e.Size(this.bpm,this.widthParMeasure),e.SetMouseDownEvent(this.OnMouseDown),this.objectList.push(e),s(t)}).catch(t=>{i(t)})},t=>{i(t)})})}SetSoundPosition(t,e,s){console.log(t),this.objectList[t].Translate(e,s)}AudioPlay(e,t){var s;s=t,null!=this.objectList&&this.objectList.map(async t=>{t.Play(e.context,e.mainGain,this.bpm,this.widthParMeasure,s)})}AudioStop(){null!=this.objectList&&this.objectList.map(async t=>{t.Stop()})}SetBpmMeaure(t,e){this.bpm=t,this.widthParMeasure=e}}class TextBox{constructor(t){this.id=t,this.onChange=null}Init(){GetElem(this.id).addEventListener("change",this.OnChange)}OnChange=()=>{null!=this.onChange&&this.onChange(GetElem(this.id).value)};SetOnChangeEvent(t){this.onChange=t}}class SelectBox{constructor(t){this.id=t,this.onChange=null}Init(){GetElem(this.id).addEventListener("change",this.OnChange)}OnChange=()=>{null!=this.onChange&&this.onChange(GetElem(this.id).value)};SetOnChangeEvent(t){this.onChange=t}}class View{constructor(t){this.mainFrame=t,this.bkColor=VIEW_BACK_COLOR,this.lineColor=VIEW_MEASURE_LINE_COLOR,this.lineColor2=VIEW_BEAT_LINE_COLOR,this.progressColor=VIEW_PROGRESS_COLOR,this.measureSize=DEFAULT_MEASURE_WIDTH,this.bpm=DEFAULT_BPM,this.camera={x:0,y:0},this.soundManager=null,this.optLine=DEFAULT_DIVIDE_NUM,this.progress={isMouseDown:!1,worldPosition:0},this.leftMoveBtn=null,this.rightMoveBtn=null}Init(){this.InitCamera(),this.createView()}InitCamera(){this.camera.x=0,this.camera.y=0}SetBpmMeasure(e,s){let i=!1,a=this.measureSize;this.measureSize!=s&&(i=!0),this.bpm=e,this.measureSize=s;var t=GetElem("view_group");null!=t&&(this.ReSize(t.getAttribute("width"),t.getAttribute("height")),null!=(t=this.soundManager.GetObjectList()))&&t.map(async t=>{t.Size(e,s),i&&this.calcStartPosForSoundObject(t,a)})}calcStartPosForSoundObject(t,e){e=GetMeasurePos(e,t.x),e=GetWorldPosFromMeasurePos(this.bpm,this.measureSize,e);t.x=e,t.svg.setAttribute("transform",`translate(${t.x-this.camera.x}, ${t.y-this.camera.y})`)}SetDivide(t){this.optLine=t;t=GetElem("view_group");null!=t&&this.ReSize(t.getAttribute("width"),t.getAttribute("height"))}SetCamera(t,e){this.camera.x=t,this.camera.y=e,this.MoveSoundObject(),this.updateMeasureNumber(),this.flashProgress()}TrackCameraToProgress(){var t=this.progress.worldPosition,e=this.camera.x,s=this.GetViewWidth();(t<e||e+s<t)&&(e=parseInt(t/this.measureSize)*this.measureSize,this.SetCamera(e,0))}SetSoundManager(t){this.soundManager=t}GetSnapPosition(t){var e=this.measureSize/this.optLine;return parseInt(t/e)*e}MoveSoundObject(){var t=this.soundManager.GetObjectList();null!=t&&t.map(async t=>{t.svg.setAttribute("transform",`translate(${t.x-this.camera.x}, ${t.y-this.camera.y})`)})}SetVisibleSoundObject(t){t=this.soundManager.GetObjectList()[t];GetElem(this.mainFrame).appendChild(t.svg),t.visible=!0}SetSoundObjectPositionLocal(t,e,s){t=this.soundManager.GetObjectList()[t],e=this.GetSnapPosition(e),e=this.LocalToWorldX(e),s=(s=this.LocalToWorldY(s))<0?0:s;t.x=e<0?0:e,t.y=s,t.svg.setAttribute("transform",`translate(${t.x-this.camera.x}, ${t.y-this.camera.y})`)}ReSize(t,e){var s=GetElem("view_group"),i=(s.setAttribute("width",t),s.setAttribute("height",e),GetElem("view_rect"));i.setAttribute("width",t),i.setAttribute("height",e),Array.from(s.childNodes).forEach(t=>{"view_rect"!=t.id&&t.remove()}),this.createViewLine(s,t,e),this.createMeasureNumber(s,t),this.resizeProgress(e),this.resizeButton(t,e)}GetViewWidth(){return GetElem(this.mainFrame).getAttribute("width")}GetViewHeight(){return GetElem(this.mainFrame).getAttribute("height")}createView(){var t=GetElem(this.mainFrame),e=t.getAttribute("width"),s=t.getAttribute("height"),i=CreateSVGElem("g","view_group"),a=(i.setAttribute("width",e),i.setAttribute("height",s),CreateRect("view_rect",0,0,e,s,this.bkColor,this.bkColor));i.appendChild(a),this.createViewLine(i,e,s),this.createMeasureNumber(i,e),t.appendChild(i),this.createProgress(),this.createButton(t,e,s),t.addEventListener("mousedown",this.OnMouseDown)}createButton(t,e,s){var i=BUTTON_RADIUS;this.leftMoveBtn=new ImgButton,this.rightMoveBtn=new ImgButton,this.leftMoveBtn.Init(t,"btnLeftMove",0,s-2*i,i,"#CFCFCF","<<"),this.rightMoveBtn.Init(t,"btnRightMove",e-2*i,s-2*i,i,"#CFCFCF",">>"),this.leftMoveBtn.SetClick(t=>{let e=this.camera.x-this.measureSize;e<0&&(e=0),this.SetCamera(e,this.camera.y)}),this.rightMoveBtn.SetClick(t=>{var e=this.camera.x+this.measureSize;this.SetCamera(e,this.camera.y)})}resizeButton(t,e){var s=BUTTON_RADIUS;this.leftMoveBtn.Move(0,e-2*s),this.rightMoveBtn.Move(t-2*s,e-2*s)}createViewLine(e,s,i){var a=CreateGroup("line_box",0,0,this.measureSize,i);for(let t=1;t<this.optLine;t++)a.appendChild(CreateLine(null,t*(this.measureSize/this.optLine),0,t*(this.measureSize/this.optLine),i,this.lineColor2,1));a.appendChild(CreateLine(null,this.measureSize,0,this.measureSize,i,this.lineColor,1)),e.appendChild(a);for(let t=1;t<s/this.measureSize;t++)e.appendChild(CreateUse(null,t*this.measureSize,0,"line_box"))}createMeasureNumber(t,e){var s=CreateGroup("number_box",0,0,e,60),i=parseInt(this.camera.x/this.measureSize);for(let t=0;t<e/this.measureSize;t++){var a=CreateText(null,t*this.measureSize,15,""+(i+t+1),"11px","#000000");s.appendChild(a)}t.appendChild(s)}updateMeasureNumber(){var t=GetElem("number_box");let s=parseInt(this.camera.x/this.measureSize);Array.from(t.childNodes).forEach((t,e)=>{t.textContent=""+(s+e+1)})}createProgress(){var t=GetElem(this.mainFrame),e=CreateLine("progress",0,0,0,t.getAttribute("height"),this.progressColor,1.5);t.appendChild(e)}resizeProgress(t){GetElem("progress").setAttribute("y2",t)}moveProgress(t){var e=GetElem("progress"),t=(this.progress.worldPosition=t,this.WorldToLocalX(t));e.setAttribute("x1",t),e.setAttribute("x2",t);e=GetElem(this.mainFrame).getAttribute("width"),e=parseInt(e/this.measureSize)*this.measureSize;e<=t&&this.SetCamera(this.camera.x+e,0)}flashProgress(){var t=GetElem("progress"),e=this.WorldToLocalX(this.progress.worldPosition);t.setAttribute("x1",e),t.setAttribute("x2",e)}getWorldProgress(){return this.progress.worldPosition}OnMouseDown=t=>(t.preventDefault(),t.stopPropagation(),this.progress.isMouseDown=!0,this.progress.worldPosition=this.GetSnapPosition(this.camera.x+t.clientX),!1);OnMouseMove(e){var t=this.soundManager.drag;t.isMouseDown&&t.targets.map(async t=>{t.offsetx=t.offsetx+e.movementX,t.offsety=t.offsety+e.movementY,this.SetSoundObjectPositionLocal(t.target.id,t.offsetx,t.offsety)})}OnMouseUp(t){this.soundManager.OnMouseUp(),this.progress.isMouseDown&&(this.progress.isMouseDown=!1,this.moveProgress(this.progress.worldPosition))}LocalToWorldX(t){return this.camera.x+t}WorldToLocalX(t){return t-this.camera.x}LocalToWorldY(t){return this.camera.y+t}WorldToLocalY(t){return t-this.camera.y}}class Player{constructor(t){this.view=t,this.soundObjectManager=new SoundObjectManager,this.bpm=DEFAULT_BPM,this.widthParMeasure=DEFAULT_MEASURE_WIDTH,this.playbackState="stop",this.progressPos=0,this.startTime=0,this.interval=null,this.webAudio={context:null,mainGain:null},this.bpmBox=new TextBox("bpm"),this.measureBox=new TextBox("measure"),this.divideBox=new SelectBox("divide")}Init(){this.view.SetBpmMeasure(this.bpm,this.widthParMeasure),this.view.SetSoundManager(this.soundObjectManager),this.soundObjectManager.SetBpmMeaure(this.bpm,this.widthParMeasure),this.bpmBox.Init(),this.bpmBox.SetOnChangeEvent(this.ChangeBpm),this.measureBox.Init(),this.measureBox.SetOnChangeEvent(this.ChangeMeasure),this.divideBox.Init(),this.divideBox.SetOnChangeEvent(this.ChangeDivide)}initAudio(){null==this.webAudio.context&&(this.webAudio.context=new(window.AudioContext||window.webkitAudioContext),this.webAudio.mainGain=this.webAudio.context.createGain(),this.webAudio.mainGain.gain.value=.3,this.webAudio.mainGain.connect(this.webAudio.context.destination))}ChangeBpm=t=>{this.bpm=t,this.view.SetBpmMeasure(this.bpm,this.widthParMeasure)};ChangeMeasure=t=>{this.widthParMeasure=t,this.view.SetBpmMeasure(this.bpm,this.widthParMeasure)};ChangeDivide=t=>{this.view.SetDivide(t)};AddSound(t,s){return new Promise((i,e)=>{this.initAudio(),this.soundObjectManager.AddSound(this.webAudio,t,s).then(t=>{var e=GetRandomInt(100),s=GetRandomInt(100);this.view.SetSoundObjectPositionLocal(t,e,s),this.view.SetVisibleSoundObject(t),i(this.soundObjectManager.GetListSize())}).catch(t=>{e(t)})})}updateProgress=()=>{var t=this.webAudio.context.currentTime,e=t-this.startTime,s=GetSecParPixel(this.bpm,this.widthParMeasure);this.startTime=t,this.progressPos+=e/s,this.view.moveProgress(this.progressPos)};Start=()=>{var t;"stop"==this.playbackState&&(this.initAudio(),this.playbackState="play",this.progressPos=this.view.getWorldProgress(),this.view.moveProgress(this.progressPos),this.view.TrackCameraToProgress(),t=GetSecFromWorldPos(this.bpm,this.widthParMeasure,this.progressPos),this.soundObjectManager.SetBpmMeaure(this.bpm,this.widthParMeasure),this.soundObjectManager.AudioPlay(this.webAudio,t),this.startTime=this.webAudio.context.currentTime,this.interval=setInterval(this.updateProgress,100))};Stop=()=>{this.playbackState="stop",this.soundObjectManager.AudioStop(),clearInterval(this.interval),this.interval=null};OnMouseUp(t){this.view.OnMouseUp(t)}OnMouseMove(t){this.view.OnMouseMove(t)}OnKeyDown(t){}setBpm(t){this.bpm=t}getBpm(){this.bpm}setWidthParMeasure(t){this.widthParMeasure=t}getWidthParMeasure(){return this.widthParMeasure}}var player=null,view=null;function init(){view=new View("mainframe"),(player=new Player(view)).Init(),initView("mainframe"),initWindowEvent(),initAudioAddAction(onAddEvent),initStartAudioAction()}function loadAudioFile(t,e){if(-1==t.type.indexOf("audio"))window.alert(t.name+" is no audio file");else{const s=new FileReader;s.onload=()=>{e&&e(s.result,t.name)},s.readAsArrayBuffer(t)}}function initAudioAddAction(t){var e=GetElem("audioFile");e.onchange=function(){loadAudioFile(e.files[0],t)}}function initStartAudioAction(){var t=GetElem("startBtn");t.addEventListener("click",()=>{"START"==t.innerText?(t.innerText="STOP",player.Start()):(t.innerText="START",player.Stop())})}function initView(t){var e=window.innerWidth-ADJUST_WIDTH,s=window.innerHeight-ADJUST_HEIGHT,t=GetElem(t);t.setAttribute("width",e),t.setAttribute("height",s),t.addEventListener("dragover",t=>(t.stopPropagation(),t.preventDefault(),!1)),t.addEventListener("dragleave",t=>(t.stopPropagation(),t.preventDefault(),!1)),t.addEventListener("drop",t=>{t.stopPropagation(),t.preventDefault();new FileReader;return loadAudioFile(t.dataTransfer.files[0],onAddEvent),!1}),view.Init()}function ReSize(t){var e=window.innerWidth-ADJUST_WIDTH,s=window.innerHeight-ADJUST_HEIGHT,t=GetElem(t);t.setAttribute("width",e),t.setAttribute("height",s),view.ReSize(e,s)}function initWindowEvent(){window.addEventListener("resize",()=>{ReSize("mainframe")}),document.addEventListener("mouseup",()=>{player.OnMouseUp()}),document.addEventListener("mousemove",t=>{player.OnMouseMove(t)}),document.addEventListener("keydown",t=>{player.OnKeyDown(t)})}function onAddEvent(t,e){player.AddSound(t,e).then(t=>{console.log(t)}).catch(t=>{window.alert(t)})}init();